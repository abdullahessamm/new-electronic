import{U as A}from"./UserForm-777a930a.js";import{_ as v,u as f,a as b,l as U,r as t,o as m,c as n,b as l,d,h as u,g as P}from"./index-92b4f33c.js";import{v as r}from"./validationMsgs-754c5d91.js";import{u as w}from"./users-061fa555.js";const F={name:"UserShowPage",data:()=>({authStore:f(),usersStore:w(),availableAbilities:b,saving:!1,userForm:{fName:"",lName:"",email:"",username:"",password:"",repeatPassword:"",abilities:[]},formErrors:{}}),computed:{formHasErrors(){return Object.keys(this.formErrors).length>0},formHasEmptyFields(){return!this.userForm.fName||!this.userForm.lName||!this.userForm.email||!this.userForm.username||this.userForm.abilities.length===0}},methods:{addAbility(e){this.userForm.abilities.push(e)},removeAbility(e){this.userForm.abilities.splice(this.userForm.abilities.indexOf(e),1)},saveUser(){this.saving=!0,this.usersStore.update(this.$route.params.id,{f_name:this.userForm.fName,l_name:this.userForm.lName,email:this.userForm.email,username:this.userForm.username,password:this.userForm.password,abilities:this.userForm.abilities}).then(()=>{this.$swal.fire({icon:"success",title:"تم التعديل.",showCancelButton:!1}),this.$router.push({name:"users"})}).catch(e=>{e.response.status===400&&(this.$swal.fire({icon:"error",title:"يوجد خطأ بالبيانات.",showConfirmButton:!1,cancelButtonText:"مراجعة"}),e.response.data.errors.username[0]==="The username has already been taken."&&(this.formErrors.username=r.usernameUnique),e.response.data.errors.email[0]==="The email has already been taken."&&(this.formErrors.email=r.emailUnique))}).finally(()=>this.saving=!1)}},watch:{userForm:{handler(e){!/^[a-zA-Z\u0621-\u064A]{2,20}$/.test(e.fName)&&e.fName?this.formErrors.fName=r.fName:delete this.formErrors.fName,!/^[a-zA-Z\u0621-\u064A]{2,20}$/.test(e.lName)&&e.lName?this.formErrors.lName=r.lName:delete this.formErrors.lName,!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.email)&&e.email?this.formErrors.email=r.email:delete this.formErrors.email,!/^[a-zA-Z0-9\.]{3,50}$/.test(e.username)&&e.username?this.formErrors.username=r.username:delete this.formErrors.username,!/^.{8,100}$/.test(e.password)&&e.password?this.formErrors.password=r.password:delete this.formErrors.password,e.password!==e.repeatPassword?this.formErrors.repeatPassword=r.repeatPassword:delete this.formErrors.repeatPassword},deep:!0}},mounted(){if(!this.authStore.can(b.users.update)||this.$route.params.id==="1"){this.$router.push({name:"users"});return}try{const e=this.usersStore.getUser(this.$route.params.id);this.userForm.fName=e.f_name,this.userForm.lName=e.l_name,this.userForm.email=e.email,this.userForm.username=e.username,this.userForm.abilities=e.abilities.split(",")}catch{this.$router.push({name:"users"})}},components:{UserForm:A,LoadingComponent:U}},g={class:"user-show-page position-absolute top-0 w-100 h-100 z-2 bg-body overflow-y-auto"},N={class:"container my-3"},h={class:"row"},E={class:"col-12"},I={class:"save-btn px-3 pb-4 text-left"},R=["disabled"],k={key:1};function S(e,i,B,z,C,s){const o=t("font-awesome-icon"),p=t("user-form"),y=t("loading-component");return m(),n("div",g,[l("div",N,[l("div",h,[l("div",E,[l("h5",null,[d(o,{icon:"fa-solid fa-user-gear"}),u(" تعديل مستخدم ")])])])]),d(p,{fName:e.userForm.fName,"onUpdate:fName":i[0]||(i[0]=a=>e.userForm.fName=a),lName:e.userForm.lName,"onUpdate:lName":i[1]||(i[1]=a=>e.userForm.lName=a),email:e.userForm.email,"onUpdate:email":i[2]||(i[2]=a=>e.userForm.email=a),username:e.userForm.username,"onUpdate:username":i[3]||(i[3]=a=>e.userForm.username=a),password:e.userForm.password,"onUpdate:password":i[4]||(i[4]=a=>e.userForm.password=a),repeatPassword:e.userForm.repeatPassword,"onUpdate:repeatPassword":i[5]||(i[5]=a=>e.userForm.repeatPassword=a),abilities:e.userForm.abilities,"onUpdate:ability:users:read":i[6]||(i[6]=a=>a?s.addAbility(e.availableAbilities.users.index):s.removeAbility(e.availableAbilities.users.index)),"onUpdate:ability:users:update":i[7]||(i[7]=a=>a?s.addAbility(e.availableAbilities.users.update):s.removeAbility(e.availableAbilities.users.update)),"onUpdate:ability:users:create":i[8]||(i[8]=a=>a?s.addAbility(e.availableAbilities.users.create):s.removeAbility(e.availableAbilities.users.create)),"onUpdate:ability:users:delete":i[9]||(i[9]=a=>a?s.addAbility(e.availableAbilities.users.delete):s.removeAbility(e.availableAbilities.users.delete)),"onUpdate:ability:employees:read":i[10]||(i[10]=a=>a?s.addAbility(e.availableAbilities.employees.index):s.removeAbility(e.availableAbilities.employees.index)),"onUpdate:ability:employees:update":i[11]||(i[11]=a=>a?s.addAbility(e.availableAbilities.employees.update):s.removeAbility(e.availableAbilities.employees.update)),"onUpdate:ability:employees:create":i[12]||(i[12]=a=>a?s.addAbility(e.availableAbilities.employees.create):s.removeAbility(e.availableAbilities.employees.create)),"onUpdate:ability:employees:delete":i[13]||(i[13]=a=>a?s.addAbility(e.availableAbilities.employees.delete):s.removeAbility(e.availableAbilities.employees.delete)),"onUpdate:ability:imports:fullRead":i[14]||(i[14]=a=>a?s.addAbility(e.availableAbilities.imports.fullIndex):s.removeAbility(e.availableAbilities.imports.fullIndex)),"onUpdate:ability:imports:read":i[15]||(i[15]=a=>a?s.addAbility(e.availableAbilities.imports.index):s.removeAbility(e.availableAbilities.imports.index)),"onUpdate:ability:imports:update":i[16]||(i[16]=a=>a?s.addAbility(e.availableAbilities.imports.update):s.removeAbility(e.availableAbilities.imports.update)),"onUpdate:ability:imports:create":i[17]||(i[17]=a=>a?s.addAbility(e.availableAbilities.imports.create):s.removeAbility(e.availableAbilities.imports.create)),"onUpdate:ability:imports:delete":i[18]||(i[18]=a=>a?s.addAbility(e.availableAbilities.imports.delete):s.removeAbility(e.availableAbilities.imports.delete)),"onUpdate:ability:exports:fullRead":i[19]||(i[19]=a=>a?s.addAbility(e.availableAbilities.exports.fullIndex):s.removeAbility(e.availableAbilities.exports.fullIndex)),"onUpdate:ability:exports:read":i[20]||(i[20]=a=>a?s.addAbility(e.availableAbilities.exports.index):s.removeAbility(e.availableAbilities.exports.index)),"onUpdate:ability:exports:update":i[21]||(i[21]=a=>a?s.addAbility(e.availableAbilities.exports.update):s.removeAbility(e.availableAbilities.exports.update)),"onUpdate:ability:exports:create":i[22]||(i[22]=a=>a?s.addAbility(e.availableAbilities.exports.create):s.removeAbility(e.availableAbilities.exports.create)),"onUpdate:ability:exports:delete":i[23]||(i[23]=a=>a?s.addAbility(e.availableAbilities.exports.delete):s.removeAbility(e.availableAbilities.exports.delete)),"onUpdate:ability:sparePartsPermits:fullRead":i[24]||(i[24]=a=>a?s.addAbility(e.availableAbilities.sparePartsPermits.fullIndex):s.removeAbility(e.availableAbilities.sparePartsPermits.fullIndex)),"onUpdate:ability:sparePartsPermits:read":i[25]||(i[25]=a=>a?s.addAbility(e.availableAbilities.sparePartsPermits.index):s.removeAbility(e.availableAbilities.sparePartsPermits.index)),"onUpdate:ability:sparePartsPermits:update":i[26]||(i[26]=a=>a?s.addAbility(e.availableAbilities.sparePartsPermits.update):s.removeAbility(e.availableAbilities.sparePartsPermits.update)),"onUpdate:ability:sparePartsPermits:create":i[27]||(i[27]=a=>a?s.addAbility(e.availableAbilities.sparePartsPermits.create):s.removeAbility(e.availableAbilities.sparePartsPermits.create)),"onUpdate:ability:sparePartsPermits:delete":i[28]||(i[28]=a=>a?s.addAbility(e.availableAbilities.sparePartsPermits.delete):s.removeAbility(e.availableAbilities.sparePartsPermits.delete)),"onUpdate:ability:monthlyReportingIncentive:read":i[29]||(i[29]=a=>a?s.addAbility(e.availableAbilities.monthlyReportingIncentives.index):s.removeAbility(e.availableAbilities.monthlyReportingIncentives.index)),"onUpdate:ability:monthlyReportingIncentive:update":i[30]||(i[30]=a=>a?s.addAbility(e.availableAbilities.monthlyReportingIncentives.update):s.removeAbility(e.availableAbilities.monthlyReportingIncentives.update)),"onUpdate:ability:monthlyReportingIncentive:create":i[31]||(i[31]=a=>a?s.addAbility(e.availableAbilities.monthlyReportingIncentives.create):s.removeAbility(e.availableAbilities.monthlyReportingIncentives.create)),"onUpdate:ability:monthlyReportingIncentive:delete":i[32]||(i[32]=a=>a?s.addAbility(e.availableAbilities.monthlyReportingIncentives.delete):s.removeAbility(e.availableAbilities.monthlyReportingIncentives.delete)),"onUpdate:ability:statistics:show":i[33]||(i[33]=a=>a?s.addAbility(e.availableAbilities.statistics.show):s.removeAbility(e.availableAbilities.statistics.show)),errors:e.formErrors},null,8,["fName","lName","email","username","password","repeatPassword","abilities","errors"]),l("div",I,[l("button",{onClick:i[34]||(i[34]=(...a)=>s.saveUser&&s.saveUser(...a)),class:"btn btn-success px-3 py-2",disabled:s.formHasErrors||s.formHasEmptyFields||e.saving},[e.saving?(m(),P(y,{key:0,width:"20px"})):(m(),n("span",k,[d(o,{icon:"fa-solid fa-floppy-disk",style:{"margin-left":"5px"}}),u(" حفظ ")]))],8,R)])])}const q=v(F,[["render",S]]);export{q as default};
