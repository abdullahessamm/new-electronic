import{A as k}from"./AddButton-725993a6.js";import{_ as S,a as g,u as C,L as F,l as x,r as y,o as s,c as a,g as _,b as t,d,h as c,e as l,m as u,v as m,q as b,i as B,j as D,t as p}from"./index-d7ffff10.js";import{u as R}from"./imports-3004b357.js";import{d as V}from"./excelMaker-46ea73aa.js";const A={name:"ImportsPage",data:()=>({availableAbilities:g,authStore:C(),importsStore:R(),initializing:!1,dateRange:[],addForm:{saving:!1,customer_name:"",cost:"",comment:""},addFormErrors:{}}),methods:{deleteImport(e){this.$swal.fire({icon:"question",title:"حذف الإيراد ؟"}).then(n=>{n.isConfirmed&&(e.deleting=!0,this.importsStore.delete(e).catch(()=>{this.$swal.fire({icon:"error",title:"حدث خطأ ما.",showConfirmButton:!1})}).finally(()=>{e&&(e.deleting=!1)}))})},createImport(){this.addForm.comment||delete this.addForm.comment,this.addForm.saving=!0,this.addForm.user=this.authStore.user,this.importsStore.create(this.addForm).then(()=>{this.$swal.fire({icon:"success",title:"تمت عملية الإضافة.",showCancelButton:!1,showConfirmButton:!1,timer:5e3}),this.addForm.comment="",this.addForm.customer_name="",this.addForm.cost=""}).catch(e=>{this.$swal.fire({icon:"error",title:"حدث خطأ تأكد من البيانات.",showCancelButton:!1,showConfirmButton:!1,timer:5e3})}).finally(()=>this.addForm.saving=!1)},updateImport(e){this.$swal.fire({title:"تحديث البيانات",html:`جارى تحديث ايراد <b>${new Date(e.created_at).toLocaleString()}</b>. برجاء الانتظار...`,showCancelButton:!1,showConfirmButton:!1}),e.editMode=!1;const n={};e.updatedCustomer_name&&(n.customer_name=e.updatedCustomer_name),e.updatedCost&&(n.cost=e.updatedCost),e.updatedComment&&(n.comment=e.updatedComment),this.importsStore.update(e.id,n).then(()=>{this.$swal.fire({icon:"success",title:"تم التحديث بنجاح.",showCancelButton:!1,showConfirmButton:!1,timer:5e3})}).catch(()=>{this.$swal.fire({icon:"error",title:"حدث خطأ تأكد من البيانات.",showCancelButton:!1,showConfirmButton:!1,timer:5e3})})},downloadReport(){V("ايرادات نيو الكترونيك",this.importsStore.filterByDate(this.dateRange[0],this.dateRange[1]),[{column:"التاريخ والوقت",type:String,value:e=>new Date(e.created_at).toLocaleString(),width:30,align:"center"},{column:"أسم العميل",type:String,value:e=>e.customer_name,width:30,align:"center"},{column:"التكلفة",type:String,value:e=>e.cost,width:30,align:"center"},{column:"ملاحظات",type:String,value:e=>e.comment,width:30,align:"center"}])}},mounted(){if(!this.authStore.can(g.imports.index)&&!this.authStore.can(g.imports.fullIndex)){this.$router.push({name:"home"});return}this.initializing=!0,this.importsStore.initialize().then(()=>{this.authStore.can(g.imports.fullIndex)&&(this.dateRange=[])}).catch(e=>{this.$swal.fire({icon:"error",title:"حدث خطأ ما.",showConfirmButton:!1})}).finally(()=>this.initializing=!1)},components:{LoadingPage:F,LoadingComponent:x,AddButton:k}},M={class:"imports-page h-100 pb-5 overflow-auto position-relative"},$={key:1,class:"py-4"},L={class:"container-fluid"},U={class:"row"},z={class:"col-12"},P={key:0,class:"row mt-5"},E={class:"col-12 col-md-6 col-lg-3 px-lg-5 mt-2"},N={style:{direction:"ltr !important"}},T={class:"col-12 col-md-6 col-lg-9 px-lg-5 text-left mt-2"},q={class:"ico"},j=t("span",{style:{"margin-right":"7px"}}," إستخراج الى ملف اكسل ",-1),G={class:"row mt-5"},H={class:"col-12 px-lg-5 px-0 overflow-x-auto"},J={class:"table table-borderless overflow-x-auto"},K={class:"bg-color-main"},O=t("th",{scope:"col",class:"bg-transparent text-white px-3"},"تاريخ العملية",-1),Q={key:0,scope:"col",class:"bg-transparent text-white px-3"},W=t("th",{scope:"col",class:"bg-transparent text-white px-3"},"اسم العميل",-1),X=t("th",{scope:"col",class:"bg-transparent text-white px-3"},"التكلفة",-1),Y=t("th",{scope:"col",class:"bg-transparent text-white px-3"},"ملاحظات",-1),Z=t("th",{scope:"col",class:"bg-transparent text-white px-3",style:{width:"135px"}},null,-1),I={key:0,class:"border-top"},ee={class:"px-3 py-4"},te=["value"],oe={class:"px-3 py-4"},se={class:"form-group"},ae={class:"px-3 py-4"},ne={class:"form-group"},le={class:"px-3 py-4"},ie={class:"form-group"},de={class:"px-3 py-4"},re=["disabled"],ce={key:1},ue={key:1,class:"mt-5"},me=t("td",{colspan:"5",class:"text-center"}," لا يوجد نتائج ",-1),pe=[me],he={key:0,class:"px-3"},_e=["value"],fe={key:1,class:"px-3"},ge=t("br",null,null,-1),ye={key:2,class:"px-3"},be=["value"],ve={key:3,class:"px-3"},we={key:0},ke={key:1},Se={key:4,class:"px-3"},Ce=["value","onInput"],Fe={key:5,class:"px-3"},xe={key:6,class:"px-3"},Be=["value","onInput"],De={key:7,class:"px-3"},Re={key:8,class:"px-3"},Ve=["value","onInput"],Ae={key:9,class:"px-3"},Me={class:"px-3"},$e=["onClick"],Le=["onClick"],Ue={key:1},ze=["onClick"],Pe={key:1},Ee={key:2,class:"border-top"},Ne={class:"px-3 py-4"},Te=["value"],qe={class:"px-3 py-4"},je={class:"form-group"},Ge={class:"px-3 py-4"},He={class:"form-group"},Je={class:"px-3 py-4"},Ke={class:"form-group"},Oe={class:"px-3 py-4"},Qe=["disabled"],We={key:1};function Xe(e,n,Ye,Ze,Ie,i){const v=y("loading-page"),r=y("font-awesome-icon"),w=y("VueDatePicker"),f=y("loading-component");return s(),a("div",M,[e.initializing?(s(),_(v,{key:0,color:"#135ea2"})):(s(),a("div",$,[t("div",L,[t("div",U,[t("div",z,[t("h5",null,[d(r,{icon:"fa-solid fa-sack-dollar"}),c(" الإيرادات ")])])]),e.authStore.can(e.availableAbilities.exports.fullIndex)?(s(),a("div",P,[t("div",E,[t("div",N,[d(w,{placeholder:"أختر التاريخ",modelValue:e.dateRange,"onUpdate:modelValue":n[0]||(n[0]=o=>e.dateRange=o),"enable-time-picker":!1,range:""},null,8,["modelValue"])])]),t("div",T,[t("button",{class:"btn btn-excel color-main",onClick:n[1]||(n[1]=(...o)=>i.downloadReport&&i.downloadReport(...o))},[t("span",q,[d(r,{icon:"fa-solid fa-file-excel"})]),j])])])):l("",!0),t("div",G,[t("div",H,[t("table",J,[t("thead",K,[t("tr",null,[O,e.authStore.isAdmin?(s(),a("th",Q,"بواسطة")):l("",!0),W,X,Y,Z])]),t("tbody",null,[e.authStore.can(e.availableAbilities.imports.create)&&e.importsStore.filterByDate(e.dateRange[0],e.dateRange[1]).length>10?(s(),a("tr",I,[t("td",ee,[t("input",{type:"text",class:"form-control",disabled:"true",value:new Date().toLocaleDateString(),style:{cursor:"not-allowed"}},null,8,te)]),t("td",oe,[t("div",se,[u(t("input",{type:"text",class:"form-control",placeholder:"أسم العميل...","onUpdate:modelValue":n[2]||(n[2]=o=>e.addForm.customer_name=o)},null,512),[[m,e.addForm.customer_name]])])]),t("td",ae,[t("div",ne,[u(t("input",{type:"number",class:"form-control",placeholder:"التكلفة...","onUpdate:modelValue":n[3]||(n[3]=o=>e.addForm.cost=o)},null,512),[[m,e.addForm.cost]])])]),t("td",le,[t("div",ie,[u(t("input",{type:"text",class:b(`form-control ${e.addFormErrors.comment?"is-invalid":""}`),placeholder:"ملاحظات...","onUpdate:modelValue":n[4]||(n[4]=o=>e.addForm.comment=o)},null,2),[[m,e.addForm.comment]])])]),t("td",de,[t("button",{class:"btn btn-primary",onClick:n[5]||(n[5]=(...o)=>i.createImport&&i.createImport(...o)),disabled:e.addForm.saving||!e.addForm.customer_name||!e.addForm.cost},[e.addForm.saving?(s(),_(f,{key:0,width:"20px"})):(s(),a("span",ce,[d(r,{icon:"fa-solid fa-plus"}),c(" إضافة ")]))],8,re)])])):l("",!0),e.importsStore.filterByDate(e.dateRange[0],e.dateRange[1]).length==0?(s(),a("tr",ue,pe)):l("",!0),(s(!0),a(B,null,D(e.importsStore.filterByDate(e.dateRange[0],e.dateRange[1]),o=>(s(),a("tr",{key:o.id},[o.editMode?(s(),a("td",he,[t("input",{type:"text",class:"form-control",value:new Date(o.created_at).toLocaleString(),disabled:"true"},null,8,_e)])):(s(),a("td",fe,[c(p(new Date(o.created_at).toLocaleDateString())+" ",1),ge,c(" "+p(new Date(o.created_at).toLocaleTimeString()),1)])),o.editMode&&e.authStore.isAdmin?(s(),a("td",ye,[t("input",{type:"text",class:"form-control",value:`${o.user.f_name} ${o.user.l_name}`,disabled:"true"},null,8,be)])):l("",!0),!o.editMode&&e.authStore.isAdmin?(s(),a("td",ve,[o.user?(s(),a("b",we,p(e.authStore.user.id===o.user.id?"أنت":`${o.user.f_name} ${o.user.l_name}`),1)):(s(),a("b",ke," غير معروف "))])):l("",!0),o.editMode?(s(),a("td",Se,[t("input",{type:"text",class:"form-control",placeholder:"أسم العميل...",value:o.customer_name,onInput:h=>o.updatedCustomer_name=h.target.value},null,40,Ce)])):(s(),a("td",Fe,p(o.customer_name),1)),o.editMode?(s(),a("td",xe,[t("input",{type:"number",class:"form-control",value:o.cost,onInput:h=>o.updatedCost=h.target.value},null,40,Be)])):(s(),a("td",De,p(o.cost)+"ج ",1)),o.editMode?(s(),a("td",Re,[t("input",{type:"text",class:"form-control",placeholder:"ملاحظات...",value:o.comment,onInput:h=>o.updatedComment=h.target.value},null,40,Ve)])):(s(),a("td",Ae,p(o.comment??"لا يوجد ملاحظات"),1)),t("td",Me,[e.authStore.can(e.availableAbilities.imports.update)&&!o.editMode?(s(),a("button",{key:0,class:"btn btn-primary mx-1 my-1",onClick:()=>o.editMode=!0},[t("span",null,[d(r,{icon:"fa-solid fa-pen-to-square"})])],8,$e)):l("",!0),e.authStore.can(e.availableAbilities.imports.update)&&o.editMode?(s(),a("button",{key:1,class:"btn btn-primary mx-1 my-1",onClick:()=>i.updateImport(o)},[o.updating?(s(),_(f,{key:0,width:"20px"})):(s(),a("span",Ue,[d(r,{icon:"fa-solid fa-floppy-disk"}),c(" حفظ ")]))],8,Le)):l("",!0),e.authStore.can(e.availableAbilities.imports.delete)&&!o.editMode?(s(),a("button",{key:2,class:"btn btn-danger mx-1 my-1",onClick:()=>i.deleteImport(o)},[o.deleting?(s(),_(f,{key:0,width:"20px"})):(s(),a("span",Pe,[d(r,{icon:"fa-solid fa-trash"})]))],8,ze)):l("",!0)])]))),128)),e.authStore.can(e.availableAbilities.imports.create)?(s(),a("tr",Ee,[t("td",Ne,[t("input",{type:"text",class:"form-control",disabled:"true",value:new Date().toLocaleDateString(),style:{cursor:"not-allowed"}},null,8,Te)]),t("td",qe,[t("div",je,[u(t("input",{type:"text",class:"form-control",placeholder:"أسم العميل...","onUpdate:modelValue":n[6]||(n[6]=o=>e.addForm.customer_name=o)},null,512),[[m,e.addForm.customer_name]])])]),t("td",Ge,[t("div",He,[u(t("input",{type:"number",class:"form-control",placeholder:"التكلفة...","onUpdate:modelValue":n[7]||(n[7]=o=>e.addForm.cost=o)},null,512),[[m,e.addForm.cost]])])]),t("td",Je,[t("div",Ke,[u(t("input",{type:"text",class:b(`form-control ${e.addFormErrors.comment?"is-invalid":""}`),placeholder:"ملاحظات...","onUpdate:modelValue":n[8]||(n[8]=o=>e.addForm.comment=o)},null,2),[[m,e.addForm.comment]])])]),t("td",Oe,[t("button",{class:"btn btn-primary",onClick:n[9]||(n[9]=(...o)=>i.createImport&&i.createImport(...o)),disabled:e.addForm.saving||!e.addForm.customer_name||!e.addForm.cost},[e.addForm.saving?(s(),_(f,{key:0,width:"20px"})):(s(),a("span",We,[d(r,{icon:"fa-solid fa-plus"}),c(" إضافة ")]))],8,Qe)])])):l("",!0)])])])])])]))])}const at=S(A,[["render",Xe]]);export{at as default};
