import{A as I}from"./AddButton-725993a6.js";import{s as M,x as w,_ as D,a as v,u as R,L as V,l as A,r as x,o as n,c as i,g as b,b as s,d as _,h as g,m as l,v as p,e as d,i as N,j as U,q as $,t as f,y as z,p as L,f as S}from"./index-d7ffff10.js";import{d as E}from"./excelMaker-46ea73aa.js";const q=M("sparePartsPermits",{state:()=>({sparePartsPermits:[]}),getters:{filterByDate:e=>(o,a)=>(o==null||o.setHours(0),o==null||o.setMinutes(0),o==null||o.setSeconds(0),a==null||a.setHours(0),a==null||a.setMinutes(0),a==null||a.setSeconds(0),e.sparePartsPermits.filter(k=>{const h=new Date(k.created_at);return h.setHours(0),h.setMinutes(0),h.setSeconds(0),!o&&!a?!o&&!a:a?h>=o&&h<=a:h>=o})),filterByString:e=>o=>e.sparePartsPermits.filter(a=>a.client_name.match(new RegExp(o.trim()))||a.permit_number.match(new RegExp(o))||a.case_number.match(new RegExp(o))||a.description.match(new RegExp(o)))},actions:{async initialize(){const e=await w.get("sparePartsPermits");this.sparePartsPermits=e.data.spare_parts_permits},async refresh(){return this.initialize()},async create(e){const{user:o}=e;delete e.user;const a=await w.post("sparePartsPermits",e);this.sparePartsPermits.unshift({...a.data.spare_parts_permit,user:o})},async delete(e){await w.delete(`sparePartsPermits/${e.id}`);const o=this.sparePartsPermits.findIndex(a=>a.id===e.id);this.sparePartsPermits.splice(o,1)},async update(e,o){await w.patch(`sparePartsPermits/${e}`,o),this.sparePartsPermits[this.sparePartsPermits.findIndex(a=>a.id==e)]={...this.sparePartsPermits[this.sparePartsPermits.findIndex(a=>a.id==e)],...o}}}});const H={name:"SparePartsPermitsPage",data:()=>({filterString:"",availableAbilities:v,authStore:R(),sparePartsPermitsStore:q(),initializing:!1,dateRange:[],addForm:{saving:!1,client_name:"",permit_number:"",case_number:"",description:""},addFormErrors:{}}),computed:{filteredPermits(){return this.sparePartsPermitsStore.filterByString(this.filterString)}},methods:{deleteSparePartsPermit(e){this.$swal.fire({icon:"question",title:"حذف الأذن ؟"}).then(o=>{o.isConfirmed&&(e.deleting=!0,this.sparePartsPermitsStore.delete(e).catch(()=>{this.$swal.fire({icon:"error",title:"حدث خطأ ما.",showConfirmButton:!1})}).finally(()=>{e&&(e.deleting=!1)}))})},createSparePartsPermit(){this.addForm.comment||delete this.addForm.comment,this.addForm.saving=!0,this.addForm.user=this.authStore.user,this.sparePartsPermitsStore.create(this.addForm).then(()=>{this.$swal.fire({icon:"success",title:"تمت عملية الإضافة.",showCancelButton:!1,showConfirmButton:!1,timer:5e3}),this.addForm.case_number="",this.addForm.client_name="",this.addForm.permit_number="",this.addForm.description=""}).catch(e=>{this.$swal.fire({icon:"error",title:"حدث خطأ تأكد من البيانات.",showCancelButton:!1,showConfirmButton:!1,timer:5e3})}).finally(()=>this.addForm.saving=!1)},updateSparePartsPermit(e){this.$swal.fire({title:"تحديث البيانات",html:`جارى تحديث ايراد <b>${new Date(e.created_at).toLocaleString()}</b>. برجاء الانتظار...`,showCancelButton:!1,showConfirmButton:!1}),e.editMode=!1;const o={};e.updatedPermitNumber&&(o.permit_number=e.updatedPermitNumber),e.updatedCaseNumber&&(o.case_number=e.updatedCaseNumber),e.updatedClientName&&(o.client_name=e.updatedClientName),e.updatedDescription&&(o.description=e.updatedDescription),o.used=e.used,this.sparePartsPermitsStore.update(e.id,o).then(()=>{this.$swal.fire({icon:"success",title:"تم التحديث بنجاح.",showCancelButton:!1,showConfirmButton:!1,timer:5e3})}).catch(()=>{this.$swal.fire({icon:"error",title:"حدث خطأ تأكد من البيانات.",showCancelButton:!1,showConfirmButton:!1,timer:5e3})})},downloadReport(){E("أذون قطع غيار نيو الكترونيك",this.sparePartsPermitsStore.filterByDate(this.dateRange[0],this.dateRange[1]),[{column:"تاريخ العملية",type:String,value:e=>new Date(e.created_at).toLocaleString(),width:30,align:"center"},{column:"رقم الاذن",type:String,value:e=>e.permit_number,width:30,align:"center"},{column:"رقم الحالة",type:String,value:e=>e.case_number,width:30,align:"center"},{column:"أسم العميل",type:String,value:e=>e.client_name,width:30,align:"center"},{column:"وصف القطعة المصروفة",type:String,value:e=>e.description,width:30,align:"center"},{column:"تم التركيب",type:String,value:e=>e.used?"✓":"",width:30,align:"center"}])}},mounted(){if(!this.authStore.can(v.sparePartsPermits.index)&&!this.authStore.can(v.sparePartsPermits.fullIndex)){this.$router.push({name:"home"});return}this.initializing=!0,this.sparePartsPermitsStore.initialize().then(()=>{this.authStore.can(v.sparePartsPermits.fullIndex)&&(this.dateRange=[])}).catch(e=>{this.$swal.fire({icon:"error",title:"حدث خطأ ما.",showConfirmButton:!1})}).finally(()=>this.initializing=!1)},components:{LoadingPage:V,LoadingComponent:A,AddButton:I}},r=e=>(L("data-v-e01485fd"),e=e(),S(),e),j={class:"sparePartsPermits-page h-100 pb-5 overflow-auto position-relative"},G={key:1,class:"py-4"},J={class:"container-fluid"},K={class:"row"},O={class:"col-12"},Q={key:0,class:"row mt-5"},W={class:"col-12 col-md-6 col-lg-3 px-lg-5 mt-2"},X={class:"col-12 col-md-6 col-lg-9 px-lg-5 text-left mt-2"},Y={class:"ico"},Z=r(()=>s("span",{style:{"margin-right":"7px"}}," إستخراج الى ملف اكسل ",-1)),P={class:"row mt-5"},T={class:"col-12 px-lg-5 px-0 overflow-x-auto"},ee={class:"table table-borderless overflow-x-auto"},te={class:"bg-color-main"},se=r(()=>s("th",{scope:"col",class:"bg-transparent text-white px-3"},"تاريخ العملية",-1)),oe=r(()=>s("th",{scope:"col",class:"bg-transparent text-white px-3"},"رقم الاذن",-1)),ne={key:0,scope:"col",class:"bg-transparent text-white px-3"},ie=r(()=>s("th",{scope:"col",class:"bg-transparent text-white px-3"},"رقم الحالة",-1)),ae=r(()=>s("th",{scope:"col",class:"bg-transparent text-white px-3"},"اسم العميل",-1)),le=r(()=>s("th",{scope:"col",class:"bg-transparent text-white px-3"},"وصف القطعة المصروفة",-1)),de=r(()=>s("th",{scope:"col",class:"bg-transparent text-white px-3"},"تم التركيب",-1)),re=r(()=>s("th",{scope:"col",class:"bg-transparent text-white px-3",style:{width:"135px"}},null,-1)),ce={key:0,class:"border-top"},ue={class:"px-3 py-4"},pe={class:"px-3 py-4"},he={class:"form-group"},me={class:"px-3 py-4"},_e={class:"form-group"},fe={class:"px-3 py-4"},ge={class:"form-group"},be={colspan:"2",class:"px-3 py-4"},ye=["disabled"],we={key:1},ve={key:1,class:"mt-5"},xe=r(()=>s("td",{colspan:"6",class:"text-center"}," لا يوجد نتائج ",-1)),ke=[xe],Ce={class:"px-3"},Be=r(()=>s("br",null,null,-1)),Fe={key:0,class:"px-3"},Ie=["value","onInput"],Me={key:1,class:"px-3"},De={key:2,class:"px-3"},Re=["value"],Ve={key:3,class:"px-3"},Ae={key:0},Ne={key:1},Ue={key:4,class:"px-3"},$e=["value","onInput"],ze={key:5,class:"px-3"},Le={key:6,class:"px-3"},Se=["value","onInput"],Ee={key:7,class:"px-3"},qe={key:8,class:"px-3"},He=["value","onInput"],je={key:9,class:"px-3"},Ge={class:"px-3"},Je=["onUpdate:modelValue","disabled"],Ke={class:"px-3"},Oe=["onClick"],Qe=["onClick"],We={key:1},Xe=["onClick"],Ye={key:1},Ze={key:2,class:"border-top"},Pe={class:"px-3 py-4"},Te={class:"px-3 py-4"},et={class:"form-group"},tt={class:"px-3 py-4"},st={class:"form-group"},ot={class:"px-3 py-4"},nt={class:"form-group"},it={colspan:"2",class:"px-3 py-4"},at=["disabled"],lt={key:1};function dt(e,o,a,k,h,c){const F=x("loading-page"),m=x("font-awesome-icon"),y=x("loading-component");return n(),i("div",j,[e.initializing?(n(),b(F,{key:0,color:"#135ea2"})):(n(),i("div",G,[s("div",J,[s("div",K,[s("div",O,[s("h5",null,[_(m,{icon:"fa-solid fa-toolbox"}),g(" أذون قطع غيار ")])])]),e.authStore.can(e.availableAbilities.exports.fullIndex)?(n(),i("div",Q,[s("div",W,[l(s("input",{type:"text",placeholder:"بحث...",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=t=>e.filterString=t)},null,512),[[p,e.filterString]])]),s("div",X,[s("button",{class:"btn btn-excel color-main",onClick:o[1]||(o[1]=(...t)=>c.downloadReport&&c.downloadReport(...t))},[s("span",Y,[_(m,{icon:"fa-solid fa-file-excel"})]),Z])])])):d("",!0),s("div",P,[s("div",T,[s("table",ee,[s("thead",te,[s("tr",null,[se,oe,e.authStore.isAdmin?(n(),i("th",ne,"بواسطة")):d("",!0),ie,ae,le,de,re])]),s("tbody",null,[e.authStore.can(e.availableAbilities.sparePartsPermits.create)&&e.sparePartsPermitsStore.filterByDate(e.dateRange[0],e.dateRange[1]).length>10?(n(),i("tr",ce,[s("td",ue,[l(s("input",{type:"text",class:"form-control",placeholder:"رقم الإذن...","onUpdate:modelValue":o[2]||(o[2]=t=>e.addForm.permit_number=t)},null,512),[[p,e.addForm.permit_number]])]),s("td",pe,[s("div",he,[l(s("input",{type:"text",class:"form-control",placeholder:"رقم الحالة...","onUpdate:modelValue":o[3]||(o[3]=t=>e.addForm.case_number=t)},null,512),[[p,e.addForm.case_number]])])]),s("td",me,[s("div",_e,[l(s("input",{type:"text",class:"form-control",placeholder:"أسم العميل...","onUpdate:modelValue":o[4]||(o[4]=t=>e.addForm.client_name=t)},null,512),[[p,e.addForm.client_name]])])]),s("td",fe,[s("div",ge,[l(s("input",{type:"text",class:"form-control",placeholder:"وصف القطعة المصروفة...","onUpdate:modelValue":o[5]||(o[5]=t=>e.addForm.description=t)},null,512),[[p,e.addForm.description]])])]),s("td",be,[s("button",{class:"btn btn-primary",onClick:o[6]||(o[6]=(...t)=>c.createSparePartsPermit&&c.createSparePartsPermit(...t)),disabled:!e.addForm.permit_number||!e.addForm.case_number||!e.addForm.client_name||!e.addForm.description||e.addForm.saving},[e.addForm.saving?(n(),b(y,{key:0,width:"20px"})):(n(),i("span",we,[_(m,{icon:"fa-solid fa-plus"}),g(" إضافة ")]))],8,ye)])])):d("",!0),e.sparePartsPermitsStore.filterByDate(e.dateRange[0],e.dateRange[1]).length==0?(n(),i("tr",ve,ke)):d("",!0),(n(!0),i(N,null,U(c.filteredPermits,t=>{var C,B;return n(),i("tr",{key:t.id,class:$(t.used===!0?"green":t.used===!1?"yellow":"")},[s("td",Ce,[g(f(new Date(t.created_at).toLocaleDateString())+" ",1),Be,g(" "+f(new Date(t.created_at).toLocaleTimeString()),1)]),t.editMode?(n(),i("td",Fe,[s("input",{type:"text",class:"form-control",placeholder:"رقم الأذن...",value:t.permit_number,onInput:u=>t.updatedPermitNumber=u.target.value},null,40,Ie)])):(n(),i("td",Me,f(t.permit_number),1)),t.editMode&&e.authStore.isAdmin?(n(),i("td",De,[s("input",{type:"text",class:"form-control",value:`${((C=t.user)==null?void 0:C.f_name)??"غير معروف"} ${((B=t.user)==null?void 0:B.l_name)??""}`,disabled:"true"},null,8,Re)])):d("",!0),!t.editMode&&e.authStore.isAdmin?(n(),i("td",Ve,[t.user?(n(),i("b",Ae,f(e.authStore.user.id===t.user.id?"أنت":`${t.user.f_name} ${t.user.l_name}`),1)):(n(),i("b",Ne," غير معروف "))])):d("",!0),t.editMode?(n(),i("td",Ue,[s("input",{type:"text",class:"form-control",placeholder:"رقم الحالة...",value:t.case_number,onInput:u=>t.updatedCaseNumber=u.target.value},null,40,$e)])):(n(),i("td",ze,f(t.case_number),1)),t.editMode?(n(),i("td",Le,[s("input",{type:"text",class:"form-control",placeholder:"أسم العميل...",value:t.client_name,onInput:u=>t.updatedClientName=u.target.value},null,40,Se)])):(n(),i("td",Ee,f(t.client_name),1)),t.editMode?(n(),i("td",qe,[s("input",{type:"text",class:"form-control",placeholder:"وصف القطعة المصروفة...",value:t.description,onInput:u=>t.updatedDescription=u.target.value},null,40,He)])):(n(),i("td",je,f(t.description),1)),s("td",Ge,[l(s("input",{type:"checkbox",class:"form-check-input",style:{width:"23px",height:"23px"},"onUpdate:modelValue":u=>t.used=u,disabled:!t.editMode},null,8,Je),[[z,t.used]])]),s("td",Ke,[e.authStore.can(e.availableAbilities.sparePartsPermits.update)&&!t.editMode?(n(),i("button",{key:0,class:"btn btn-primary mx-1 my-1",onClick:()=>t.editMode=!0},[s("span",null,[_(m,{icon:"fa-solid fa-pen-to-square"})])],8,Oe)):d("",!0),e.authStore.can(e.availableAbilities.sparePartsPermits.update)&&t.editMode?(n(),i("button",{key:1,class:"btn btn-primary mx-1 my-1",onClick:()=>c.updateSparePartsPermit(t)},[t.updating?(n(),b(y,{key:0,width:"20px"})):(n(),i("span",We,[_(m,{icon:"fa-solid fa-floppy-disk"}),g(" حفظ ")]))],8,Qe)):d("",!0),e.authStore.can(e.availableAbilities.sparePartsPermits.delete)&&!t.editMode?(n(),i("button",{key:2,class:"btn btn-danger mx-1 my-1",onClick:()=>c.deleteSparePartsPermit(t)},[t.deleting?(n(),b(y,{key:0,width:"20px"})):(n(),i("span",Ye,[_(m,{icon:"fa-solid fa-trash"})]))],8,Xe)):d("",!0)])],2)}),128)),e.authStore.can(e.availableAbilities.sparePartsPermits.create)?(n(),i("tr",Ze,[s("td",Pe,[l(s("input",{type:"text",class:"form-control",placeholder:"رقم الإذن...","onUpdate:modelValue":o[7]||(o[7]=t=>e.addForm.permit_number=t)},null,512),[[p,e.addForm.permit_number]])]),s("td",Te,[s("div",et,[l(s("input",{type:"text",class:"form-control",placeholder:"رقم الحالة...","onUpdate:modelValue":o[8]||(o[8]=t=>e.addForm.case_number=t)},null,512),[[p,e.addForm.case_number]])])]),s("td",tt,[s("div",st,[l(s("input",{type:"text",class:"form-control",placeholder:"أسم العميل...","onUpdate:modelValue":o[9]||(o[9]=t=>e.addForm.client_name=t)},null,512),[[p,e.addForm.client_name]])])]),s("td",ot,[s("div",nt,[l(s("input",{type:"text",class:"form-control",placeholder:"وصف القطعة المصروفة...","onUpdate:modelValue":o[10]||(o[10]=t=>e.addForm.description=t)},null,512),[[p,e.addForm.description]])])]),s("td",it,[s("button",{class:"btn btn-primary",onClick:o[11]||(o[11]=(...t)=>c.createSparePartsPermit&&c.createSparePartsPermit(...t)),disabled:!e.addForm.permit_number||!e.addForm.case_number||!e.addForm.client_name||!e.addForm.description||e.addForm.saving},[e.addForm.saving?(n(),b(y,{key:0,width:"20px"})):(n(),i("span",lt,[_(m,{icon:"fa-solid fa-plus"}),g(" إضافة ")]))],8,at)])])):d("",!0)])])])])])]))])}const pt=D(H,[["render",dt],["__scopeId","data-v-e01485fd"]]);export{pt as default};
